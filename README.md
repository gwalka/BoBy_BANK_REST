## BoBy BANK REST API

REST API для управления банковскими картами с авторизацией, шифрованием, генерацией уникальных номеров и проверкой по алгоритму Луна.

**Технологии:** Java 17+, Spring Boot, Spring Security, JPA, PostgreSQL/MySQL, Liquibase, Docker, JWT, Swagger (OpenAPI).

---


## Быстрый старт
```bash
git clone https://github.com/gwalka/Boby_Bank_Rest.git
```
```bash
cd Boby_Bank_Rest
```
```bash
docker-compose up --build
```

Крнтейнер поднимает приложение и базу данных.
После запуска сервис доступен по адресу:
```bash
http://localhost:8080/swagger-ui/index.html#/
```
Все эндопинты кроме регистрации и логина защищены.
Поскольку не предусмотрена прямая регистрация администротора миграция предусматривает наличие его в базе для удобного тестирования
```bash
http://localhost:8080/swagger-ui/index.html#/auth-controller/login
```
```bash
{
"username": "Rowdey8",
"password": "P@ssw0rd123"
}
```
В ответе вы получите JWT токен, который необходимо вставить в кнопку Authorize в Swagger UI для доступа к защищённым эндпоинтам.

## Разграничение доступа:
Пользователь имеет доступ только к эндпоинтам user-card-controller.

Администратор имеет доступ только к эндпоинтам admin-card-controller.


## Документация API

Полная спецификация API доступна в файле openapi.yaml и через Swagger UI.
```bash
https://github.com/gwalka/Boby_Bank_Rest/blob/main/openapi.yaml
```


## О проекте
Решение полностью покрывает требования

# Основные возможности
- Авторизация с JWT и разграничением ролей (админ / пользователь)
- Администратор: создание, блокировка, активация, удаление, просмотр карт
- Пользователь: просмотр своих карт, баланса, номера карты, блокировка карты, перевод средств между своими картами
- Генерация уникальных номеров карт с заданным в конфигурации BIN, шифрование и хранение
- Валидация номеров по алгоритму Луна для предотвращения ошибок
- Локальный кэш для быстрой выдачи карт и пессимистическая блокировка для предотвращения дублирования при параллельной работе

## Почему локальный кэш, а не Redis?
- Локальный кэш реализован через ArrayBlockingQueue, а метод генерации защищён ReentrantLock.
- В рамках одного инстанса вызов генерации происходит только одним потоком, исключает избыточные запросы.
- Для синхронизации между несколькими инстансами используется пессимистическая блокировка таблицы с максимальным суффиксом карты.
- Повторная генерация начинается с текущего максимального суффикса, что гарантирует уникальность.

## Тестирование
Ключевая бизнес-логика покрыта unit тестами






